{% block content %}
{% load static %}
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MobSF Static Analysis Report</title>
    <meta name="description" content="MobSF Report">
    {% if host_os == 'windows' %}
        <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    {% else %}
    <style>
    
      /* latin */
      @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: local('Open Sans Regular'), local('OpenSans-Regular'), url('{{base_url}}{% static 'fonts/Open_Sans/OpenSans-Regular.ttf' %}') format('truetype');
      }

      /* latin */
      @font-face {
        font-family: 'Oswald';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: local('Oswald'), local('Oswald'), url('{{base_url}}{% static 'fonts/Oswald/Oswald-Regular.ttf' %}') format('truetype');
      }
     
  </style>
  {% endif %}
  <link rel="stylesheet" href="{{base_url}}{% static "others/css/pdf_report.css" %}">
  <link rel="stylesheet" href="{{base_url}}{% static "adminlte/plugins/fontawesome-free/css/all.min.css" %}">
  </head>

  <body bgcolor="FFFFFF">
    <article id="cover">
      <div class="header">
        <img src="{{base_url}}{% static "img/mobsf_logo.png" %}" class="center logo" alt="MobSF Logo"/>
        <div class="htext">ANDROID STATIC ANALYSIS REPORT </div>
      </div>
      </br></br></br>
     <div class="app">
      <img class="center" id="icon" src="{% if icon_found %}{{dwd_dir}}{{ md5 }}-icon.png{% else %}{{base_url}}{% static 'img/no_icon.png' %}{% endif %}" alt="app_icon"/>
     </div>
      <div class="center">
        <h1><i class="fab fa-android"></i> {{ app_name }} {% if version_name %}  ({{version_name}}) {% endif %}</h1>
      </div>
     </br></br></br></br></br>
      <div class="container">
      <table class="basic no_border">
      <tr class="no_border">
        <td class="no_border"><h3>File Name:</h3></td>
        <td class="no_border"><h3>{{file_name}}</h3></td>
      </tr>
      <tr>
        <td class="no_border"><h3>Package Name:</h3></td>
        <td class="no_border"><h3>{{ package_name }}</h3></td>
      </tr>
      <tr>
        <td class="no_border"><h3>Average CVSS Score:</h3></td>
        <td class="no_border"><h3>
  
        {% if average_cvss > 6 %}
        <span class="danger">{{ average_cvss }} </span>
        {% elif average_cvss == 0 %}
        {{ average_cvss }}
        {% elif average_cvss >= 4 %}
        <span class="warning">{{ average_cvss }}</span>
        {% elif average_cvss < 4 %}
        <span class="success">{{ average_cvss }}</span>
        {% endif %}
        </h3></td>
      </tr>
      <tr>
        <td class="no_border"><h3>App Security Score:</h3></td>
        <td class="no_border">
        <h3> 
          {% if security_score < 16 %}
            <span class="danger">{{ security_score }}/100 (CRITICAL RISK)</span>
          {% elif security_score < 41 %}
            <span class="high">{{ security_score }}/100 (HIGH RISK)</span>
          {% elif security_score < 71 %}
            <span class="warning">{{ security_score }}/100 (MEDIUM RISK)</span>
          {% else %}
            <span class="success">{{ security_score }}/100 (LOW RISK)</span>
          {% endif %}
        </h3>
        </td>
      </tr>
      <tr>
        <td class="no_border"><h3>Scan Date:</h3></td>
        <td class="no_border"><h3>{{ timestamp }}</h3></td>
      </tr>
    </table>
      </div>
      </br></br>
      </br></br>
      </br></br>
      </br></br>
      </br></br>
      </br></br>
      </br></br>
      </br></br>
    </article>
    
    <article id="contents">

      
      <h2><i class="fas fa-box-open"></i> FILE INFORMATION</h2>

      <h5>File Name:</h5> {{ file_name }}</br>
      <h5>Size: </h5> {{ size }}</br>
      <h5>MD5:</h5> {{ md5 }}</br>
      <h5>SHA1:</h5> {{ sha1 }}</br>
      <h5>SHA256:</h5> {{ sha256 }}</br>
     

      <h2><i class="fas fa-info"></i> APP INFORMATION</h2>

      <h5>App Name:</h5> {{ app_name }}</br>
      <h5>Package Name:</h5> {{ package_name }}</br>
      <h5>Main Activity:</h5> {{ main_activity }}</br>
      <h5>Target SDK:</h5> {{ target_sdk }}</br>
      <h5>Min SDK:</h5> {{ min_sdk }}</br>
      <h5>Max SDK:</h5> {{ max_sdk }}</br>
      <h5>Android Version Name:</h5> {{ version_name }}</br>
      <h5>Android Version Code:</h5> {{ version_code }}</br>

      <h2><i class="fas fa-th-large"></i> APP COMPONENTS </h2>

        <h5>Activities:</h5> {{ activities | length }}</br>
        <h5>Services:</h5> {{ services | length }}</br>
        <h5>Receivers:</h5> {{ receivers | length }}</br>
        <h5>Providers:</h5> {{ providers | length }}</br>
        <h5>Exported Activities:</h5> <span {% if exported_count.exported_activities > 0 %} class="danger" {% endif %}> {{ exported_count.exported_activities }}</span></br>
        <h5>Exported Services:</h5> <span {% if exported_count.exported_services > 0 %} class="danger" {% endif %}> {{ exported_count.exported_services }}</span></br>
        <h5>Exported Receivers:</h5> <span {% if exported_count.exported_receivers > 0 %} class="danger" {% endif %}> {{ exported_count.exported_receivers }}</span></br>
        <h5>Exported Providers:</h5> <span {% if exported_count.exported_providers > 0 %} class="danger" {% endif %}> {{ exported_count.exported_providers }}</span></br>
     
        <h2><i class="fa fa-certificate"></i> CERTIFICATE INFORMATION</h2>
        {% if certificate_analysis.certificate_info %}
        <div class="panel-body">
              <p class="wrapped-text">{{ certificate_analysis.certificate_info }}</p>
              <!--Cert status-->
                 <table class="basic">
                      <thead>
                          <tr>
                              <th>STATUS</th>
                              <th>DESCRIPTION</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for find in certificate_analysis.certificate_findings %}
                          <tr>
                          <td>
                          {% if find.0 == 'bad' %}
                            <span class="danger">bad</span>
                          {% elif find.0  == 'good' %}
                            <span class="success">secure</span>
                          {% elif find.0  == 'warning' %}
                            <span class="warning">warning</span>
                          {% endif %}
                          </td>
                          <td>{{ find.1 }}</td>
                          </tr>
                          {% endfor %}
                      </tbody>
                  </table>
        </div>
      {% else %}
      <span class="danger">Failed to read Code Signing Certificate or none available.</span>
      {% endif %}
      {% if permissions %}
      <h2><i class="fa fa-list"></i> 应用权限清单</h2>

            <table class="basic">
              <thead>
            <tr>
                <th>PERMISSION</th>
                <th>STATUS</th>
                <th>INFO </th>
                <th>DESCRIPTION</th>
              </tr>
            </thead>
            <tbody>
            {% for perm,desc in permissions.items %}
            <tr>
            <td>{{ perm }}</td>
            <td>
            {% if desc.status == 'dangerous' %}
              <span class="danger">危险</span>
            {% elif desc.status == 'normal' %}
              <span class="info">普通</span>
            {% elif desc.status == 'signatureOrSystem' %}
              <span class="warning">签名或者系统级</span>
            {% elif desc.status == 'signature' %}
              <span class="success">签名保护</span>
            {% elif desc.status == 'unknown' %}
              <span class="secondary">未知</span>
            {% endif %}
            </td>
            <td>{{ desc.info }}</td>
            <td>{{ desc.description }}</td>
            </tr>
            {% endfor %}
            </tbody>
            </table>
      {% endif %}

      
      {% if browsable_activities %}
      <h2><i class="fas fa-clone"></i> BROWSABLE ACTIVITIES</h2>
       <table class="basic">
                                        <thead>
                                            <tr>
                                                <th>ACTIVITY</th>
                                                <th>INTENT</th>   
                                            </tr>
                                        </thead>
                                        <tbody>
                      {% for activity,intent_details in browsable_activities.items %}
                          <tr>
                            <td>{{activity}}</td>
                            <td>
                                   {% if intent_details|key:"schemes" %}
                                      <strong>Schemes</strong>: 
                                      {% for scheme in intent_details|key:"schemes" %}
                                        {{scheme}},
                                      {% endfor %}
                                       </br>
                                   {% endif %}
                                   {% if intent_details|key:"hosts" %}
                                      <strong>Hosts:</strong> {% for host in intent_details|key:"hosts" %}
                                        {{host}},
                                      {% endfor %} 
                                      </br>
                                   {% endif %}
                                   {% if intent_details|key:"ports" %}
                                      <strong>Ports:</strong> {% for port in intent_details|key:"ports" %}
                                        {{port}},
                                      {% endfor %} 
                                      </br>
                                   {% endif %}
                                   {% if intent_details|key:"mime_types" %}
                                      <strong>Mime Types:</strong> {% for mime in intent_details|key:"mime_types" %}
                                        {{mime}},
                                      {% endfor %} 
                                      </br>
                                   {% endif %}
                                   {% if intent_details|key:"paths" %}
                                      <strong>Paths:</strong> {% for path in intent_details|key:"paths" %}
                                        {{path}},
                                      {% endfor %} 
                                      </br>
                                   {% endif %}
                                   {% if intent_details|key:"path_prefixs" %}
                                      <strong>Path Prefixes:</strong> {% for prefix in intent_details|key:"path_prefixs" %}
                                        {{prefix}},
                                      {% endfor %} 
                                      </br>
                                   {% endif %}
                                   {% if intent_details|key:"path_patterns" %}
                                      <strong>Path Patterns:</strong> {% for pattern in intent_details|key:"path_patterns" %}
                                        {{pattern}},
                                      {% endfor %} 
                                      </br>
                                   {% endif %}
                              {% endfor %}
                            </td>
                          </tr>
                    </tbody>
                    </table>
      {% endif %}


     <h2><i class="fas fa-lock"></i> NETWORK SECURITY</h2>
     <table class="basic">
                    <thead>
                        <tr>
                          <th>NO</th>
                          <th>SCOPE</th>
                          <th>SEVERITY</th>
                          <th>DESCRIPTION</th>
                                </tr>
                            </thead>
                            <tbody>
                    {% for item in network_security %}
                      <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                         {% for url in item.scope %}
                          {{ url }}</br>
                        {% endfor %}
                        </td>
                        <td>
                          {% if item.severity == "high" %}
                            <span class="danger">high</span>
                          {% elif item.severity == "good" %}
                            <span class="good">good</span>
                          {% elif item.severity == "info" %}
                            <span class="info">info</span>
                          {% elif item.severity == "warning" %}
                             <span class="warning">warning</span>
                          {% endif %}
                        </td>
                        <td>
                        {{item.description }}
                        </td>
   
                       </tr>
                     {% endfor %}
										</tbody>
										</table>
    
    <h2><i class="fas fa-search"></i> MANIFEST ANALYSIS</h2>
      <table class="basic">
        <thead>
          <tr>
            <th>NO</th>
            <th>ISSUE</th>
            <th>SEVERITY</th>
            <th>DESCRIPTION</th>
          </tr>
        </thead>
        <tbody>
        {% for item in manifest_analysis %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
            {{item|key:"title" | safe}}
            </td>
            <td>

              {% if item|key:"stat" == "high" %}
                <span class="danger">high</span>
              {% elif item|key:"stat" == "info" %}
                <span class="info">info</span>
              {% elif item|key:"stat" == "medium" %}
                <span class="warning">medium</span>
              {% endif %}
              
            </td>
            <td>
            {{item|key:"desc"}}
            </td>

            </tr>
          {% endfor %}

        </tbody>
      </table>

      <h2><i class="fab fa-android"></i> ANDROID API</h2>
        <table class="basic">
          <thead>
              <tr>
                <th>NO</th>
                <th>API</th>
                <th>Pattern</th>
                <th>FILES</th>
              </tr>
          </thead>
          <tbody>
          {% for rule, details in android_api.items %}
          <tr>
            <td width="5%">{{ forloop.counter }}</td>
            <td width="10%">
              {{ details.metadata.description }}
            </td>
            <td width="25%">
              {{ details.metadata.pattern }}
            </td>
            <td width="60%">
              {% for file_path, lines in details.files.items %}
                  {{ file_path }} ({{lines}})<br/>
              {% endfor %}
            </td>
            </tr>    
            {% endfor %} 
           </tbody>
        </table>

      <h2><i class="fas fa-code"></i> CODE ANALYSIS</h2>
       <table class="basic">
                <thead>
                    <tr>
                        <th>NO</th>
                        <th>ISSUE</th>
                        <th>SEVERITY</th>
                        <th>STANDARDS</th>
                        <th>FILES</th>
                    </tr>
                </thead>
                <tbody>
                   {% for rule, details in code_analysis.items %}
                  <tr>
                  <td width="5%">{{ forloop.counter }}</td>
                  <td width="15%">
                    {% if details.metadata|key:"ref" %}
                    <a href="{{details.metadata.ref}}" target="_blank" rel="noopener"> {{ details.metadata.description }}</a>
                    {% else %}
                      {{ details.metadata.description }}
                    {% endif %}
                  </td>
                  <td width="5%">
                      {% if details.metadata.severity == "high" %}
                      <span class="danger">high</span>
                      {% elif details.metadata.severity == "good" %}
                      <span class="success">secure</span>
                      {% elif details.metadata.severity == "warning" %}
                      <span class="warning">warning</span>
                      {% elif details.metadata.severity == "info" %}
                      <span class="info">info</span>
                      {% endif %}
                  </td>
                  <td width="15%">
                      <strong>CVSS V2:</strong> {{ details.metadata.cvss }}
                      {% if details.metadata.cvss > 6 %}
                        <span class="danger"> (high)</span>
                      {% elif details.metadata.cvss == 0 %}
                        <span class="info">(info)</span>
                      {% elif details.metadata.cvss >= 4 %}
                        <span class="warning"> (medium)</span>
                      {% elif details.metadata.cvss < 4 %}
                        <span class="success"> (low)</span>
                      {% endif %}
                      {% if details.metadata.cwe %}</br> 
                      <strong>CWE: </strong> {{ details.metadata.cwe }}
                      {% endif %}
                      {% if details.metadata|key:"owasp-mobile" %}</br> 
                      <strong>OWASP Top 10: </strong> {{ details.metadata|key:"owasp-mobile" }}
                      {% endif %}
                      {% if details.metadata.masvs %}</br> 
                      <strong>OWASP MASVS: </strong>{{ details.metadata.masvs }}
                      {% endif %}
                  </td>
                 <td width="60%" style="word-break:break-all;">
                  {% for file_path in details.files %}
                    {{ file_path }}
                  <br/>
                  {% endfor %}
                  </td>
                </tr>    
              {% endfor %} 
										</tbody>
			</table>
            
    </article>
    <article>
    </br>
    <h3> App Security Score Calculation </h3>
    <p>
    Every app is given an ideal score of 100 to begin with.</br>
    For every findings with severity <span class="danger">high</span> we reduce 15 from the score.</br>
    For every findings with severity <span class="warning">warning</span> we reduce 10 from the score.</br>
    For every findings with severity <span class="success">good</span> we add 5 to the score.</br>
    If the calculated score is greater than 100, then the app security score is considered as 100.</br>
    And if the calculated score is less than 0, then the app security score is considered as 10.</br>
    </p>
  <h3> Risk Calculation </h3>
  <p>
        <table class="basic">
            <thead>
                <tr>
                    <th>APP SECURITY SCORE</th>
                    <th>RISK</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td width="50%">0 - 15</td>
                    <td><span class="danger">CRITICAL</span></td>
                </tr>
                <tr>
                    <td>16 - 40</td>
                    <td><span class="high">HIGH</span></td>
                </tr>
                <tr>
                    <td>41 - 70</td>
                    <td><span class="warning">MEDIUM</span></td>
                </tr>
                <tr>
                    <td>71 - 100</td>
                    <td><span class="success">LOW</span></td>
                </tr>
            </tbody>
        </table>
  </p>
    </article>

    <article id="columns">
      </br>
      <hr>
      <h3>Report Generated by - GeeTest MobSF {{ version }} </h3>
      <section>
        <p>
          Mobile Security Framework (MobSF) is an automated, all-in-one mobile application (Android/iOS/Windows) pen-testing, malware analysis and security assessment framework capable of performing static and dynamic analysis.
        </p>
        <p>
        <strong>© {% now "Y" %} Mobile Security Framework - GeeTest MobSF</strong>
      </p>
      </section>
    </article>
  </body>
</html>
{% endblock %}
